{% extends 'master/base.html' %}

{% block title %}
  {% if request.resolver_match.url_name == 'images.update' %}
    Update Image
  {% else %}  
    Add Image
  {% endif %} 
{% endblock title %}

{% block dashboard_title1 %}
  {% if request.resolver_match.url_name == 'images.update' %}
    Update Image
  {% else %}  
    Add Image
  {% endif %} 
{% endblock dashboard_title1 %}

{% block dashboard_title2 %}
  {% if request.resolver_match.url_name == 'images.update' %}
    Edit Image
  {% else %}  
    Add Image
  {% endif %}
{% endblock dashboard_title2 %}

{% load static %}

{% block content %}
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        {% load crispy_forms_tags %}

                        <form action="{% if request.resolver_match.url_name == 'images.update' %}{% url 'images.update' id %}{% else %}{% url 'images.add' %}{% endif %}" method="POST" class="form-group" enctype="multipart/form-data">
                            {% csrf_token %}
                              {{ form|crispy }}

                              {% if request.resolver_match.url_name == 'images.update' %}
                                <button type="submit" class="btn btn-success">Update Image</button>
                              {% else %}  
                                <button type="submit" class="btn btn-success">Add Image</button>
                              {% endif %}  
                        </form>

                        {% if request.resolver_match.url_name == 'images.update' %}
                            <small>Old Images:</small>
                            {% comment %} {% for image_file in image_files %}
                                <a style="padding:0 6px;background:#ddd;" href="#!" onclick="showImagePop(event, '{% if image_file.file %}{{image_file.file.url}}{% else %}{% static 'dist/img/default-150x150.png' %}{% endif %}','Image failed to load.')">{{forloop.counter}}</a>
                            {% endfor %} {% endcomment %}
                            
                            <div class="col-sm-8">
                                <div class="row" id="img-content-row">
                                    {% for image_file in image_files %}
                                        <div class="img-flex" style="{% if image_file.tested %}outline:2px solid green;{% else %}outline:2px solid salmon;{% endif %}">
                                            <img class="img-card" src="{{image_file.file.url}}" onclick="showImagePop(event, '{% if image_file.file %}{{image_file.file.url}}{% else %}{% static 'dist/img/default-150x150.png' %}{% endif %}','Image failed to load.','{% if image_file.result %}Title/Class: {{image_file.result|title}} <br/> Score: {{image_file.score}} <br/> Object: {{image_file.object_type|title}}{% else %}<i style=color:maroon>Not Tested</i>{% endif %}')" alt="Failed to Load"/>
                                            <a title="Delete" data-toggle="tooltip" data-placement="top" onclick="deleteData(event,'image_file_{{image_file.id}}','Uploaded Image')" class="img-delete" style="color:red !important;"><i class="fa fa-trash-alt"></i></a>
                                            {% if not image_file.result %}
                                            <a title="Re-test" onclick="disableImages(event)" data-toggle="tooltip" data-placement="top" href="{% url 'images.image_file.retest' image_file.id %}" class="img-delete" style="right: 40px;color:lightblue;"><i class="fa fa-sync"></i></a>
                                            {% endif %}
                                            <form action="{% url 'images.image_file.delete' image_file.id %}" id="image_file_{{image_file.id}}" method="POST">
                                                {% csrf_token %}
                                            </form>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                            <p><small style="color:Red;">(If Images are Supplied on Update it will be appended)</small></p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <script>function disableImages(t){var e=document.getElementById("img-content-row");e.style.pointerEvents="none",e.style.opacity="0.8",t.target.className+=" fa-spin";var a=t.target.parentNode;a.style.visibility="visible",a.style.opacity="1",a.style.transform="translate(0,0)"}</script>
{% endblock content %}